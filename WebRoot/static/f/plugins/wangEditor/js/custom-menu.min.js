!function(){"use strict";var c,d,e,f,a=window.wangEditor,b=window.jQuery;a.createMenu(function(c){var e,f,d="save";c(d)&&(e=this,f=new a.Menu({editor:e,id:d,title:"保存",$domNormal:b('<a href="#" tabindex="-1" id="save-btn" style="color:#FFF;"><i class="glyphicon glyphicon-floppy-disk"></i></a>'),$domSelected:b('<a href="#" tabindex="-1" class="selected"><i class="glyphicon glyphicon-floppy-disk"></i></a>')}),f.clickEvent=function(){var d,f,g,h,i,j,k,l,m,n,o,p,q,r,c=b("#save-btn");if(1!=c.attr("data-is-sub")){if(c.css("background","#9A9A9A").attr("data-is-sub",1),d=b.trim(b("#artilce-title").val()),f=/^\s*$/,f.test(d))return layer.msg("请输入文章标题",{time:1e3},function(){c.css("background","").removeAttr("data-is-sub")});if(d.replace(/[^\x00-\xff]/g,"01").length>80)return layer.msg("文章标题过长",{time:1e3},function(){c.css("background","").removeAttr("data-is-sub")});if(g=e.$txt.formatText(),f.test(g)||"请输入内容..."===g)return layer.msg("请输入文章内容",{time:1e3},function(){c.css("background","").removeAttr("data-is-sub")});for(b("#artilce-title").val(filterXSS.escapeHtml(d)),b("#summary").val(filterXSS.escapeHtml(b.trim(g.substring(0,134)))),h=e.$txt.html(),b("#editor").val(filterXSS(h)),i=e.$txt.find("img"),j="",k="thumb.gif",l=null,m=0;m<i.length;m++)l=b(i[m]).attr("src"),-1==l.indexOf(k)&&(j+=l+";");for(b("#artimgs").val(j.substring(0,j.length-1)),n=b("#article_tags").val().split(","),o=[],p=null,m=0,q=n.length;q>m;m++)p=mapping[n[m]],void 0==p&&(p=0),o[m]=p;b("#article_tag_ids").val(o.join(",")),r=b("#articleForm").serialize(),b.post(jui.uri+"/article/save",r,function(a){var b,d,e;if(a.success)layer.msg("操作成功",{time:800,icon:1},function(){location.href=jui.uri+"/zone"});else{c.css("background","").removeAttr("data-is-sub"),b=a.data,d=!0;for(e in b)d=!1,layer.msg(b[e],{time:1e3,icon:5});d&&layer.msg(a.msg,{time:1e3,icon:5})}},"json")}},e.menus[d]=f)}),b("#article_source").change(function(){var a=b(this).val();1==a?b("#article_from").removeAttr("disabled").parent().slideDown("fast"):b("#article_from").attr("disabled","disabled").parent().slideUp("fast")}),b("#theme-choosed").on("click",function(){b("#theme-options").slideToggle("fast")}),b(".tm-opt").on("click",function(){var a=b(this),c=a.attr("data-no");a.addClass("selected").siblings().removeClass("selected"),b("#article_theme").val(c),b("#theme-choosed > span").html(a.html()),a.parent().slideUp("fast")}),c=b("#theme-options > .selected"),c[0]?(b("#article_theme").val(c.attr("data-no")),b("#theme-choosed > span").html(c.html())):b(".tm-opt:first")[0].click(),b("#flg-choosed").on("click",function(){b("#flg-options").slideToggle("fast")}),b(".flg-opt").on("click",function(){var a=b(this),c=a.attr("data-no");a.addClass("selected").siblings().removeClass("selected"),b("#article_flag").val(c),b("#flg-choosed > span").html(a.html()),a.parent().slideUp("fast")}),d=b("#flg-options > .selected"),d[0]?(b("#flg_theme").val(c.attr("data-no")),b("#flg-choosed > span").html(d.html())):b(".flg-opt:first")[0].click(),b("#type-choosed").on("click",function(){b("#type-options").slideToggle("fast")}),b("#type-options").on("click",".t-option",function(a){if(a.target==this){var c=b(this).attr("data-no");b("#article_type").val(c),b(this).addClass("selected").siblings().removeClass("selected"),b("#type-choosed span").html(b(this).text()),b(this).parent().slideUp("fast")}}),b("#type-options").on("mouseenter",".t-option",function(){b(this).find("i").show()}).on("mouseleave",".t-option",function(){b(this).find("i").hide()}),b("#type-options").on("click",".type-opt",function(){var a="edit",c=b(this),d=c.parent().attr("data-no"),e=c.parent().text();c.hasClass("delete")?a="delete":c.hasClass("add")&&(a="add"),"edit"===a||"add"===a?layer.open({type:1,title:"编辑分类",closeBtn:!1,area:"300px;",shade:!1,id:"LAY_layuipro",resize:!1,btn:["确定","取消"],btnAlign:"c",moveType:1,content:'<p><input id="edit_type_name" class="qt-select" style="width:280px; margin:20px 10px 10px;" type="text" value="'+e+'" placeholder="输入分类名称"/></p>',success:function(a){var e=a.find(".layui-layer-btn");e.find(".layui-layer-btn0").on("click",function(){var a=b("#edit_type_name").val(),e=/^[a-zA-Z0-9\u4e00-\u9fa5]{1,10}$/,f={"type.type_name":a};d&&(f["type.type_id"]=d),e.test(a)?b.post(jui.uri+"/type/save",f,function(e){var f,g,h,i;e.success?(layer.msg("操作成功"),d?(f=a+'<i class="type-opt delete glyphicon glyphicon-trash" style="display: none;"></i><i class="type-opt edit glyphicon glyphicon-pencil" style="display: none;"></i>',c.parent().html(f),g=b("#article_type").val(),d==g&&b("#type-choosed span").html(a)):(h=e.data.type,i='<li class="t-option" data-no="'+h.type_id+'">'+h.type_name+'<i class="type-opt delete glyphicon glyphicon-trash" style="display: none;"></i><i class="type-opt edit glyphicon glyphicon-pencil" style="display: none;"></i></li>',b(".t-add").before(i))):layer.msg("操作失败",{icon:5})},"json"):layer.msg("名称不能超过10个字，可中英文混合")})}}):layer.msg("确定删除该分类么？",{time:0,btn:["确定","取消"],yes:function(){b.post(jui.uri+"/type/del/"+d,function(a){if(a.success){var e=b("#article_type").val();d==e&&(b("#article_type").val(0),b("#type-choosed span").html("选择分类...")),layer.msg("删除成功"),c.parent().slideUp("fast",function(){c.parent().remove()})}else layer.msg("删除失败",{icon:5})},"json")}})}),wangEditor.config.printLog=!1,e=new wangEditor(ed),e.config.emotions={"default":{title:"默认",data:jui.uri+"/static/data/emotions_default.data"}},e.config.codeDefaultLang="javascript",e.config.uploadImgUrl=jui.uri+"/upload/editor?upload_type=image",e.config.uploadImgFileName="upload",e.config.menus=["bold","underline","italic","strikethrough","eraser","forecolor","bgcolor","|","quote","fontfamily","fontsize","head","alignleft","aligncenter","alignright","|","table","emotion","|","img","video","insertcode","|","fullscreen","|","save"],e.create(),b(".menu-group:last").css({"float":"right",borderRight:0,padding:0,background:"#FF766C"}).find(".menu-item").width("60px"),f=b("#article_tags"),f.tagEditor({placeholder:"添加标签...",onChange:function(a,b,c){c.length>5&&(layer.msg("不能超过5个标签!",{time:800}),f.tagEditor("removeTag",c[5]))}}),b(".tag-editor").on("click",function(){b(".recmd-container").fadeIn("fast")}),b(".rcmd-tag").on("click",function(){var e,a=b(this),c=a.attr("data-tag-id"),d=a.html();f.tagEditor("addTag",d),e=b("#article_tag_ids"),e.val(e.val()+","+c)})}();