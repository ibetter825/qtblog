function getComtsByAjax(){var a=$(".more-comts");a.addClass("more-comts-loading").find("a").hide(),$.post(jui.uri+"/comt/"+artno+"-"+Number(jui.ajaxpager)+"-10",function(b){var d,e,f,g,h,i,c=b.comts;if(!c||0==c.length)return Number(jui.ajaxpager)>1&&layer.msg("没有更多评论了",{time:800,icon:5}),a.hide(),void 0;for(a.removeClass("more-comts-loading").find("a").show(),jui.ajaxpager=Number(jui.ajaxpager)+1,d=b.replies,e=b.rtime,f=b.raccno,g=[],h=null,i=0;i<c.length;i++)h=c[i],g.push(createDetailComtOrReplyHtml(e,f,h,1).join(""));for($("#comment-list").append(g.join("")),h=null,i=0;i<d.length;i++)h=d[i],$("#comment-"+h.comt_no+"-children").append(createDetailComtOrReplyHtml(e,f,h,2).join(""))},"json").error(function(b,c,d){a.removeClass("more-comts-loading").find("a").show(),$.ER.handle(b,c,d)})}function createDetailComtOrReplyHtml(a,b,c,d){var l,e=1==d?c.comt_no:c.reply_no,f=c.comt_no,g=1==d?"li-comment-"+e:"li-reply-"+e,h=1==d?"comment-"+e:"reply-"+e,i=1==d?c.comt_content:c.reply_content,j=1==d?23:24,k="";return(b==toacc||c.from_acc==b)&&(k='<a href="javascript:void(0);" onclick="return addComment.D(\''+e+"',"+d+');"><i title="删除" class="glyphicon glyphicon-trash"></i></a>'),l=[],l.push('<li class="comment depth-'+d+'" id="'+g+'">'),l.push('<div class="c-avatar"><a href="'+jui.uri+"/main/"+c.from_acc+'"><img data-original="'+jui.uri+c.from_avatar+'" class="avatar avatar-100" src="'+jui.uri+c.from_avatar+'"></a></div>'),l.push('<div class="c-main" id="'+h+'" data-comt-no="'+f+'"><span class="c-author from_name">'+c.from_name+(1==d?"</span>：":'</span><i class="text-split">回复</i><span class="c-receiver to_name">'+c.to_name+"</span>：")+'<span class="comt-reply-cont">'+i+"</span>"),l.push('<time class="c-time">'+$.timeago(c.add_time)+"</time>"),l.push("<span class='comment-reply-link'><a rel='nofollow' href='replytocom="+j+"#respond' onclick='return addComment.moveForm(\""+h+'", "2", "respond", "'+c.from_acc+'")\' title="回复"><i class="glyphicon glyphicon-comment"></i></a>'+k+'<a href="javascript:void(0);" onclick="return art.report('+d+","+e+',this);"><i title="举报" class="glyphicon glyphicon-exclamation-sign"></i></a></span></div>'),l.push('<ul class="children" id="comment-'+e+'-children"></ul>'),l.push("</li>"),l}!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a){function d(){var c=e(this),d=b.settings;return isNaN(c.datetime)||(0==d.cutoff||g(c.datetime)<d.cutoff)&&a(this).text(f(c.datetime)),this}function e(c){if(c=a(c),!c.data("timeago")){c.data("timeago",{datetime:b.datetime(c)});var d=a.trim(c.text());b.settings.localeTitle?c.attr("title",c.data("timeago").datetime.toLocaleString()):!(d.length>0)||b.isTime(c)&&c.attr("title")||c.attr("title",d)}return c.data("timeago")}function f(a){return b.inWords(g(a))}function g(a){return(new Date).getTime()-a.getTime()}var b,c;a.timeago=function(b){return b instanceof Date?f(b):"string"==typeof b?f(a.timeago.parse(b)):"number"==typeof b?f(new Date(b)):f(a.timeago.datetime(b))},b=a.timeago,a.extend(a.timeago,{settings:{refreshMillis:6e4,allowFuture:!1,localeTitle:!1,cutoff:0,strings:{prefixAgo:null,prefixFromNow:null,suffixAgo:"前",suffixFromNow:"from now",seconds:"1分钟",minute:"1分钟",minutes:"%d分钟",hour:"1小时",hours:"%d小时",day:"1天",days:"%d天",month:"1月",months:"%d月",year:"1年",years:"%d年",wordSeparator:"",numbers:[]}},inWords:function(b){function k(d,e){var f=a.isFunction(d)?d(e,b):d,g=c.numbers&&c.numbers[e]||e;return f.replace(/%d/i,g)}var f,g,h,i,j,l,m,c=this.settings.strings,d=c.prefixAgo,e=c.suffixAgo;return this.settings.allowFuture&&0>b&&(d=c.prefixFromNow,e=c.suffixFromNow),f=Math.abs(b)/1e3,g=f/60,h=g/60,i=h/24,j=i/365,l=45>f&&k(c.seconds,Math.round(f))||90>f&&k(c.minute,1)||45>g&&k(c.minutes,Math.round(g))||90>g&&k(c.hour,1)||24>h&&k(c.hours,Math.round(h))||42>h&&k(c.day,1)||30>i&&k(c.days,Math.round(i))||45>i&&k(c.month,1)||365>i&&k(c.months,Math.round(i/30))||1.5>j&&k(c.year,1)||k(c.years,Math.round(j)),m=c.wordSeparator||"",void 0===c.wordSeparator&&(m=" "),a.trim([d,l,e].join(m))},parse:function(b){var c=a.trim(b);return c=c.replace(/\.\d+/,""),c=c.replace(/-/,"/").replace(/-/,"/"),c=c.replace(/T/," ").replace(/Z/," UTC"),c=c.replace(/([\+\-]\d\d)\:?(\d\d)/," $1$2"),new Date(c)},datetime:function(c){var d=b.isTime(c)?a(c).attr("datetime"):a(c).attr("title");return b.parse(d)},isTime:function(b){return"time"===a(b).get(0).tagName.toLowerCase()}}),c={init:function(){var e,c=a.proxy(d,this);c(),e=b.settings,e.refreshMillis>0&&setInterval(c,e.refreshMillis)},update:function(c){a(this).data("timeago",{datetime:b.parse(c)}),d.apply(this)},updateFromDOM:function(){a(this).data("timeago",{datetime:b.parse(b.isTime(this)?a(this).attr("datetime"):a(this).attr("title"))}),d.apply(this)}},a.fn.timeago=function(a,b){var d=a?c[a]:c.init;if(!d)throw new Error("Unknown function name '"+a+"' for timeago");return this.each(function(){d.call(this,b)}),this},document.createElement("abbr"),document.createElement("time")}),getComtsByAjax(),+function(a){var d,e,j,o,b=!1;1==a.CK.get("IS_LOGIN")&&(b=!0),a("#comment").on("click",function(){return b?void 0:(a.LG.nl(),a("#comment").blur(),!1)}),d='<div class="comt-tip comt-loading">正在提交, 请稍候...</div>',e='<div class="comt-tip comt-error">#</div>',j=[],j.push(""),$comments=a("#comments-title"),$cancel=a("#cancel-comment-reply-link"),cancel_text=$cancel.text(),$submit=a("#commentform #submit"),$submit.attr("disabled",!1),a(".comt-tips").append(d+e),a(".comt-loading").hide(),a(".comt-error").hide(),$body=window.opera?"CSS1Compat"==document.compatMode?a("html"):a("body"):a("html,body"),a("#commentform").submit(function(){var c,d,e,f;return b?(c=a("#comment").val(),d=/^\s*$/,d.test(c)?!1:(a(".comt-loading").show(),$submit.attr("disabled",!0).fadeTo("slow",.5),e=a(this),f=a("#post_type").val(),a.ajax({url:e.attr("action"),data:e.serialize(),type:e.attr("method"),error:function(b){a(".comt-loading").hide(),a(".comt-error").show().html(b.responseText),setTimeout(function(){$submit.attr("disabled",!1).fadeTo("slow",1),a(".comt-error").fadeOut()},3e3)},success:function(b){var c,d,g,h;a(".comt-loading").hide(),$submit.attr("disabled",!1).fadeTo("slow",1),b.success?(c=b.data.dto,d=c.comt_no,c.from_name=b.data.from_name,c.from_avatar=b.data.from_avatar,g=b.data.rtime,e[0].reset(),1==f?(0==a("#comment-list>li").length?a("#comment-list").append(createDetailComtOrReplyHtml(g,c.from_acc,c,f).join("")):a("#comment-list>li").first().before(createDetailComtOrReplyHtml(g,c.from_acc,c,f).join("")),a("html,body").animate({scrollTop:a("#comment-list").offset().top-50},"fast")):2==f&&(h=a("#"+e.attr("data-root-id")),c.to_name=h.find(".from_name").html(),a("#comment-"+d+"-children").append(createDetailComtOrReplyHtml(g,c.from_acc,c,f).join(""))),addComment.C()):layer.msg(b.msg,{icon:0})}}),!1)):(a.LG.nl(),!1)}),addComment={moveForm:function(c,d,e,f){if(!b)return a.LG.nl(),!1;var h,g=this,i=g.I(c),j=g.I(e),k=g.I("cancel-comment-reply-link"),l=g.I("post_type"),m=g.I("post_comt_no"),n=g.I("post_to_acc");g.respondId=e,h=document.createElement("div"),h.id="wp-temp-form-div",h.style.display="none",j.parentNode.insertBefore(h,j),i?i.parentNode.insertBefore(j,i.nextSibling):(temp=g.I("wp-temp-form-div"),g.I("comment_parent").value="0",temp.parentNode.insertBefore(j,temp),temp.parentNode.removeChild(temp)),$body.animate({scrollTop:a("#respond").offset().top-180},400),l.value=d,"2"==d&&(g.I("commentform").setAttribute("data-root-id",c),m.value=g.I(c).getAttribute("data-comt-no"),j.setAttribute("data-root-id",c),n.value=f),k.style.display="",k.onclick=function(){addComment.C()};try{g.I("comment").focus()}catch(o){}return!1},I:function(a){return document.getElementById(a)},C:function(){var a=this,b=addComment,c=b.I("wp-temp-form-div"),d=b.I(b.respondId),e=a.I("post_to_acc"),f=a.I("cancel-comment-reply-link");if(c&&d)return b.I("post_type").value="1",e.value=toacc,c.parentNode.insertBefore(d,c),c.parentNode.removeChild(c),f.style.display="none",f.onclick=null,!1},D:function(b,c){var d=jui.uri+"/comt/del/"+b+"-"+c;a.post(d,function(d){d.success?1==c?a("#li-comment-"+b).slideUp("fast",function(){a(this).remove()}):2==c&&a("#li-reply-"+b).slideUp("fast",function(){a(this).remove()}):layer.msg("操作失败,请稍后重试",{icon:5})},"json")}},$submit.val(),a.get(jui.uri+"/article/info",{artno:artno,author:toacc},function(b){""!=b&&a("#article-meta").append(b)}),jsonp(jui.uri+"/article/opts?artno="+artno,function(b){a("#article-social").html(b)}),o=a("#param-art-theme").val(),"other"!==o?jsonp(jui.uri+"/rmd/"+o,function(b){""===b?a("#relate-rmd-container").hide():(a("#relate-rmd").html(b),a("#relate-rmd .thumb").lazyload({placeholder:jui.uri+"/static/f/images/thumbnail.gif",event:"scrollstop"}))}):a("#relate-rmd-container").hide(),jsonp(jui.uri+"/rmd",function(b){a("#hot-rmd").html(b),a("#hot-rmd .thumb").lazyload({placeholder:jui.uri+"/static/f/images/thumbnail.gif",event:"scrollstop"})})}(jQuery);